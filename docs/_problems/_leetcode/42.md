<!-- prettier-ignore-start -->

> ç»™å®š `n` ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºå®½åº¦ä¸º 1 çš„æŸ±å­é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­èƒ½æ¥çº³å¤šå°‘é›¨æ°´ã€‚<br>
> 
>   Example:
```
è¾“å…¥ï¼šheight = [0,1,0,2,1,0,1,3,2,1,2,1]
è¾“å‡ºï¼š6
è§£é‡Šï¼š
    â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›ï¸â¬œâ¬œâ¬œâ¬œ
    â¬œâ¬œâ¬œâ¬›ï¸ğŸŸ¦ğŸŸ¦ğŸŸ¦â¬›ï¸â¬›ï¸ğŸŸ¦â¬›ï¸â¬œ
    â¬œâ¬›ï¸ğŸŸ¦â¬›ï¸â¬›ï¸ğŸŸ¦â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
```
Note:
>
- `1 <= height.length < 2x10^4`
- `0 <= height[i] <= 10^5`
>
> (Hard)

<!-- prettier-ignore-end -->

<br>

### å•è°ƒæ ˆ

å•è°ƒæ ˆçš„æ€è·¯:

-   å•è°ƒæ ˆæŒ‰é™åºä¿å­˜æŸ±å­çš„é«˜åº¦ï¼Œå…¶å«ä¹‰å¦‚ (1) æ‰€ç¤ºï¼Œä¸ºè®¡ç®—é›¨æ°´é‡ï¼Œç­‰é«˜çš„æŸ±å­ä¿å­˜æœ€è¿‘çš„ç´¢å¼•
-   æ¯é‡åˆ°ä¸€ä¸ªæŸ±å­ï¼Œå…ˆè€ƒè™‘é›¨æ°´å¡«å……ï¼Œå¦‚ (2) æ‰€ç¤ºéœ€è¦å¡«å……ä¸¤æ¬¡ï¼›å†æ›´æ–°å•è°ƒæ ˆçš„çŠ¶æ€ï¼Œå¦‚ (3) æ‰€ç¤º

```
example
(1). stack=[4(3), 2(6)], i=8  (2). stack=[4(3), 2(6)], i=9   (3). stack=[4(1), 2(6)], i=9
â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œâ¬œâ¬œâ¬œ            â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œâ¬œâ¬œâ¬œâ¬œ          â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œâ¬œâ¬œâ¬œâ¬œ
â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œâ¬œâ¬œâ¬œ            â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œâ¬œâ¬œâ¬œâ¬›ï¸          â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œ            â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œâ¬›ï¸          â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œ            â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬œâ¬œâ¬›ï¸          â¬œâ¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
```

??? adcodes "solution"

    ```cpp
    class Solution {
    public:
        int trap(vector<int>& height) {
            int res = 0;
            stack<int> stack;
            for (int i = 0; i < height.size(); ++i) {
                if (height[i] == 0) {
                    continue;
                }
                if (stack.empty()) {
                    stack.push(i);
                    continue;
                }
                // é‡åˆ°ä¸€ä¸ªæŸ±å­ï¼Œä¸”å•è°ƒæ ˆéç©º
                int lastH = 0;
                while (!stack.empty()) {
                    int h = std::min(height[stack.top()], height[i]);
                    res += (i - stack.top() - 1) * (h - lastH);
                    lastH = h;
                    if (height[stack.top()] > height[i]) { // å•è°ƒæ ˆé‡Œæ¯”å½“å‰é«˜çš„æŸ±å­
                        stack.push(i);
                        break;
                    }
                    stack.pop();
                }
                if (stack.empty()) { // å½“å‰æŸ±å­æ¯”å•è°ƒæ ˆé‡Œæ‰€æœ‰çš„éƒ½é«˜
                    stack.push(i);
                }
            }
            return res;
        }
    };
    ```

æ—¶é—´ $O(n)$ ç©ºé—´ $O(n)$

### åŠ¨æ€è§„åˆ’

æ¯ä¸ªä½ç½®å¡«å……çš„é›¨æ°´é‡ = min(å·¦ä¾§æœ€é«˜æŸ±å­ï¼Œå³ä¾§æœ€é«˜æŸ±å­) - è¯¥æŸ±å­é«˜åº¦

-   `leftMax[i]`: &ensp; `[0, i]` ä¸­çš„æœ€å¤§å€¼
-   `rightMax[i]`: &ensp; `[i, end]` ä¸­çš„æœ€å¤§å€¼
-   `value[i] = min{leftMax[i], rightMax[i]} - height[i]`

??? adcodes "solution"

    ```cpp
    class Solution {
    public:
        int trap(vector<int>& height) {
            int res = 0;
            vector<int> leftMax(height.size());
            vector<int> rightMax(height.size());
            leftMax[0] = height[0];
            for (int i = 1; i < height.size(); ++i) {
                leftMax[i] = std::max(leftMax[i - 1], height[i]);
            }
            rightMax[height.size() - 1] = height[height.size() - 1];
            for (int i = height.size() - 2; i >= 0; --i) {
                rightMax[i] = std::max(rightMax[i + 1], height[i]);
            }
            for (int i = 1; i < height.size() - 1; ++i) {
                res += std::min(leftMax[i], rightMax[i]) - height[i];
            }
            return res;
        }
    };
    ```

æ—¶é—´ $O(n)$ ç©ºé—´ $O(n)$

### åŒæŒ‡é’ˆ

è‹¥ `leftMax[i] < rightMax[j] (âˆ€j > i)`ï¼Œåˆ™ `leftMax[i] < rightMax[i]`ï¼Œæ®æ­¤ï¼ŒåŠ¨æ€è§„åˆ’çš„æ€è·¯å¯ç®€åŒ–ä¸ºåŒæŒ‡é’ˆå®ç°

-   åˆå§‹ `i=0, j=N-1, leftMax=height[i], rightMax=height[j]`
-   å·¦æŒ‡é’ˆ `i` ä¸æ–­å³ç§»ï¼Œç›´åˆ°æ»¡è¶³ `height[i] > height[j]`
    -   å³ç§»çš„è¿‡ç¨‹ç­‰ä»·äºå¯»æ‰¾ã€Œæ»¡è¶³ `leftMax[i]` å¤§äº `rightMax[j]` çš„ `i`ã€
    -   æ‰¾åˆ°è¿™æ ·çš„ `i` åï¼Œ`height[i]` å¿…å®šç­‰äº `leftMax[i]`
    -   è¯¥è¿‡ç¨‹çš„æ‰€æœ‰ `leftMax[i'] < rightMax[j]`ï¼Œåˆ™ `leftMax[i'] < rightMax[i']`
-   å³æŒ‡é’ˆ `j` ä¸æ–­å·¦ç§»ï¼Œç›´åˆ°æ»¡è¶³ `height[i] <= height[j]` (åŒç†)

ç»ˆæ­¢æ¡ä»¶åº”ä¸º `i < j`:

-   `i == j` æ—¶ï¼Œå‡è®¾ `i` å…ˆåˆ°è¾¾ï¼Œ`height[i]` å·¦ä¾§æœ€é«˜ï¼›`j` å‘å®ƒé è¿‘ï¼Œå®ƒä¹Ÿä¸ºå³ä¾§æœ€é«˜ï¼Œå³ `ij` è½åœ¨æœ€é«˜çš„æŸ±å­
-   è¾¹ç•Œ case `height=[1]`

??? adcodes "solution"

    ```cpp
    class Solution {
    public:
        int trap(vector<int>& height) {
            int res = 0;
            int i = 0, j = height.size() - 1;
            int leftMax = height[i], rightMax = height[j]; // leftMax[i] & rightMax[j]
            while (i < j) {
                if (height[i] < height[j]) {
                    res += leftMax - height[i]; // leftMax[i] < rightMax[i]
                    ++i;
                    leftMax = std::max(leftMax, height[i]);
                } else {
                    res += rightMax - height[j]; // rightMax[j] < leftMax[j]
                    --j;
                    rightMax = std::max(rightMax, height[j]);
                }
            }
            return res;
        }
    };
    ```

æ—¶é—´ $O(n)$ ç©ºé—´ $O(1)$
